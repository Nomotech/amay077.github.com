<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: xamarin | Experiments Never Fail]]></title>
  <link href="http://blog.amay077.net/blog/categories/xamarin/atom.xml" rel="self"/>
  <link href="http://blog.amay077.net/"/>
  <updated>2016-09-29T22:50:54+09:00</updated>
  <id>http://blog.amay077.net/</id>
  <author>
    <name><![CDATA[amay077]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Xamarinハンズオン浜松(再び) で講師をしました]]></title>
    <link href="http://blog.amay077.net/blog/2016/09/10/joined-xamarin-hads-on-ad-hamamatsu-revenge/"/>
    <updated>2016-09-10T20:43:45+09:00</updated>
    <id>http://blog.amay077.net/blog/2016/09/10/joined-xamarin-hads-on-ad-hamamatsu-revenge</id>
    <content type="html"><![CDATA[<ul>
<li><a href="http://jaghama.connpass.com/event/37686/">Xamarinハンズオン浜松(再び) #JXUG #jaghama &ndash; connpass</a></li>
</ul>


<!--more-->


<p><a href="http://blog.amay077.net/blog/2016/07/10/joined_xamarin_hads_on_ad_hamamatsu/">前回</a> から２ヶ月、「もう一度浜松で開催して欲しい」と要望があったとのことで、前回の田淵さんに代わり、講師役として協力させていただきました。</p>

<h2>プレイベント「さわやかを食べる会」</h2>

<p>今回もウォーミングアップは さわやか です（前回とは違う店だよ）。
前回は げんこつハンバーグ でしたが、今回は <em>普通の</em> ハンバーグ、こいつもウマイ！！</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/joined_xamarin_hands_on_ad_hamamatsu_2_01.JPG" alt="" /></p>

<h2>ハンズオン振り返り</h2>

<p>一応、概要説明の資料はこちらにおいておきますね(前回の講師である田淵さんの資料をほぼ丸パクリですがｗ)。</p>

<ul>
<li><a href="http://www.slideshare.net/amay077/xamarin-xamarin201609-jxug-jaghama">Xamarin基礎講座 Xamarinハンズオン(2016.09 浜松) #JXUG #jaghama</a></li>
</ul>


<p>今回は約２０名の方に参加していただけました。</p>

<p>会場がとてもキレイでした、ご協力ありがとうございます、○○鉄道さま！（どこまで公開してよいか分からないから一応伏せといた）</p>

<p>Windows + Visual Studio の方が多かったのに、私自身が普段 Mac + Xamarin Studio 使いなので、ちょっと不安だなー、と思っていましたが、その通りでした💧</p>

<p>何名かの人で、 Visual Studio ならでは(?) な問題が発生して、環境が作れなかったりしました。
本当はその場で解決してあげたかったんですが、Visual Studio のトラブルシューティングの引き出しが少なく…。</p>

<p>とはいえ、今後も Mac から Windows に乗り換えることは無さそうなので、どうしたもんかなぁ、という感じです。</p>

<h2>打ち上げ</h2>

<p>駅前の浜松餃子屋さんで軽く打ち上げ。混んでたためか、餃子の追加注文お断りとのことで、余裕を持って頼んだ結果こうなりました。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/joined_xamarin_hands_on_ad_hamamatsu_2_02.JPG" alt="" /></p>

<p>大人５人だったからなんとか食べきれましたね、浜松餃子も旨かった！</p>

<h2>ちょまどさん</h2>

<p>Microsoft のエバンジェリストであるちょまど(<a href="https://twitter.com/chomado">@chomado</a>)さんも来ていただき、サポートスタッフをお願いしました、ありがとうございました！</p>

<p>新たな伝説のネタとなって、浜松<strong>市</strong> も大変うれしく思います（^^）</p>

<ul>
<li><a href="http://togetter.com/li/1020144">浜松町と浜松 &ndash; Togetterまとめ</a></li>
</ul>


<blockquote class="twitter-tweet" data-conversation="none" data-lang="ja"><p lang="ja" dir="ltr"><a href="https://twitter.com/chomado">@chomado</a> <br><br>だいたいさ！<br><br>浜松<br>と<br>浜松町<br><br>が全然違うところなんて本当に知らなかったよ！<br><br>会社(日本マイクロソフト品川本社)の隣駅と浜松町だと思ってたら、<br><br>まさかの新幹線ですよ！<br><br>もちろん自費です！</p>&mdash; ちょまど@MS入社してから5ヶ月 (@chomado) <a href="https://twitter.com/chomado/status/771907617555828740">2016年9月3日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">以前も浜松市の勉強会に、浜松町と間違えて登録された方がいましたが、間違いに気づいてキャンセルされました。実際に来られたのは <a href="https://twitter.com/chomado">@chomado</a> さんが初めてです。</p>&mdash; 4度目S+のあめいスピナーリミックス (@amay077) <a href="https://twitter.com/amay077/status/771913137792491520">2016年9月3日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>また次回も <del>浜松町と間違えて</del> 来てください！</p>

<h2>地方も Xamarin がんばろう</h2>

<p>東京・関東あたりは、Xamarin の勉強会を毎月数回やっている感じですが、地方はまだまだ少なめ。</p>

<p>直近だと、長野県でもくもく会があるそうです。</p>

<ul>
<li><a href="http://glnagano.connpass.com/event/39782/">ギークラボ長野 Xamarinもくもく会 &ndash; connpass</a></li>
</ul>


<p>地方の観光スポットor特産品を釣り餌にしていただけると、ワタシも喰いつきやすいです。
よろしくおねがいします。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xamarin.iOS でインターネット通信が可能かを取得する]]></title>
    <link href="http://blog.amay077.net/blog/2016/08/26/ger_is_network_available_on_xamarin_ios/"/>
    <updated>2016-08-26T23:59:59+09:00</updated>
    <id>http://blog.amay077.net/blog/2016/08/26/ger_is_network_available_on_xamarin_ios</id>
    <content type="html"><![CDATA[<p>Xamarin.iOS で、「端末からインターネット通信が可能か？」を調べたい。</p>

<!--more-->


<p>Objective-C だと <a href="https://github.com/tonymillion/Reachability">Reachability</a>、swift だと <a href="https://github.com/ashleymills/Reachability.swift">Reachability.swift</a> を使うようだけど、 Xamarin.iOS ではどうするか？</p>

<ul>
<li><a href="http://d.hatena.ne.jp/scientre/20150527/get_network_status_in_swift">Swift でネットワーク状況を調べる &ndash; メモ用紙</a></li>
</ul>


<p>Bindingライブラリがあるのかな？と思ったら、サンプルで C# のソースコードが提供されていた。</p>

<ul>
<li><a href="https://developer.xamarin.com/recipes/ios/network/reachability/detect_if_network_is_available/">Detect if Network is Available &ndash; Xamarin</a></li>
</ul>


<p>の <a href="https://github.com/xamarin/monotouch-samples/blob/master/ReachabilitySample/reachability.cs"><code>reachability.cs</code></a> がそれ。
（名前から察して Reachability.swift を C# で書きなおしたもの？詳しくは見てないけど。）</p>

<p>で、このサンプルの <code>Reachability</code> を使うと、以下のような感じで、「インターネット通信が可能か？」を調べられる。</p>

<p>```csharp
public bool IsNetworkAvailable
{</p>

<pre><code>get
{
    return Reachability.InternetConnectionStatus() != NetworkStatus.NotReachable;
}
</code></pre>

<p>}
```</p>

<p>WiFi とかセルラーとか細かいステータスもあるので、あとはコードを見てください。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NavigationPage + MasterDetailPage の時に iOS の NavigationBar の左ボタンをカスタマイズする]]></title>
    <link href="http://blog.amay077.net/blog/2016/07/22/customizing_left_button_on_%20NavigationBar_in_using_navigationpage_with_masterdetailpage/"/>
    <updated>2016-07-22T23:59:59+09:00</updated>
    <id>http://blog.amay077.net/blog/2016/07/22/customizing_left_button_on_ NavigationBar_in_using_navigationpage_with_masterdetailpage</id>
    <content type="html"><![CDATA[<p>Xamarin.Forms では、左からスライドして出てくるメニューを持つ画面を <code>MasterDetailPage</code> で作成します。</p>

<!--more-->


<ul>
<li><a href="https://developer.xamarin.com/guides/xamarin-forms/user-interface/navigation/master-detail-page/">Master-Detail Page &ndash; Xamarin</a></li>
</ul>


<p>一方、普通に画面遷移していく場合は ContentPage などを <code>NavigationPage</code> でラップしてあげます。</p>

<ul>
<li><a href="https://developer.xamarin.com/guides/xamarin-forms/user-interface/navigation/hierarchical/">Hierarchical Navigation &ndash; Xamarin</a></li>
</ul>


<h2>やりたいこと</h2>

<p>何がしたいかというと、両者を組み合わせたいんです。こういうことってよくありませんかね？</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/customizing_left_navvigationbar_button_in_masterdetail_with_navigation_pages_01.png" alt="" /></p>

<p>起動画面で「新規ユーザー登録」があって、「ユーザー登録画面」を経て、メインの画面に遷移する、メイン画面にはスライドメニューがある、というパターン。これを Xamarin.Forms でやりたいのです。</p>

<h2>問題</h2>

<p>ところが、 <code>NavigationPage</code> で遷移していく画面の中に <code>MasterDetailPage</code> があると、 <code>NavigationPage</code> の方が勝ってしまい、ナビゲーションバーには「BACK」ボタンが表示されてしまいます。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/customizing_left_navvigationbar_button_in_masterdetail_with_navigation_pages_02.png" alt="" /></p>

<p>これを消そうと、<code>MasterDetailPage</code> のコンストラクタで <code>NavigationPage.SetHasBackButton(this, false)</code> してみます。</p>

<p>その結果がこれ。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/customizing_left_navvigationbar_button_in_masterdetail_with_navigation_pages_03.png" alt="" /></p>

<p>Android の方は望む結果になったけど、iOSの方はうーん…、BACKボタンは消えたけど、メニューを表示させるボタンが出ません。</p>

<p>しょうがないので、iOS の場合だけ、ナビゲーションバーの左ボタンをどうにかして追加してみます。</p>

<h2>私が求めていたソリューション（CustomRenderer編）</h2>

<p>Xamarin.Forms のお供、CustomRenderer です。</p>

<ul>
<li><a href="https://developer.xamarin.com/guides/xamarin-forms/custom-renderer/">Customizing Controls on Each Platform &ndash; Xamarin</a></li>
<li><a href="http://ticktack.hatenablog.jp/entry/2016/06/11/124751">【Xamarin.Forms】ViewRendererと仲良くなるための簡易チュートリアル &ndash; ぴーさんログ</a></li>
</ul>


<p><code>MasterDetailPage</code> の iOS向けCustomRenderer を作って、ネイティブ側でナビゲーションバーをカスタマイズしてみます。</p>

<p>```csharp CustomMasterDetailRenderer.cs
using System;
using MasterDetail.iOS;
using MonoTouch.UIKit;
using Xamarin.Forms;
using Xamarin.Forms.Platform.iOS;</p>

<p>[assembly: ExportRenderer(typeof(MasterDetailPage), typeof(CustomMasterDetailRenderer))]
namespace MasterDetail.iOS
{</p>

<pre><code>public class CustomMasterDetailRenderer : PhoneMasterDetailRenderer
{
    public override void ViewWillAppear(bool animated)
    {
        base.ViewWillAppear(animated);

        var page = Element as MasterDetailPage;

        var navigationItem = this.NavigationController.TopViewController.NavigationItem;
        navigationItem.LeftBarButtonItems = new UIBarButtonItem[]
        {
            new UIBarButtonItem("MENU", UIBarButtonItemStyle.Plain, (_, __) =&gt; 
            { 
                page.IsPresented = !page.IsPresented; 
            })
        };
    }
}
</code></pre>

<p>}
```
「MENU」ってボタンを、ナビゲーションバーの左側に追加しています。
こんな CustomRenderer を iOS 側のプロジェクトに追加して実行してみます。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/customizing_left_navvigationbar_button_in_masterdetail_with_navigation_pages_04.png" alt="" /></p>

<p>オーケーオーケー、これが私が求めていたソリューションです。</p>

<h2>私が求めていたソリューション（Effects編）</h2>

<p>が、CustomRenderer にはいくつか考えなければならないことがあります。</p>

<ul>
<li>上で作った <code>CustomMasterDetailRenderer.cs</code> は <code>PhoneMasterDetailRenderer</code> というクラスを継承しています。が、実はこれは iPhone 用で、実はタブレット（iPad）用に <code>TabletMasterDetailRenderer</code> というクラスもあります。これの CustomRenderer も用意しなければなりませんか？</li>
<li>CustomRenderer はベースとなる ViewRenderer を「継承」して作ります。そして C# は多重継承を許していません、この意味が分かるな？別の機能を拡張したいと思ったら<code>CustomMasterDetailRenderer</code>から派生させるしかなくなります。</li>
</ul>


<p>で、 Xamarin.Forms には、v2.1 から既存機能の拡張に Effects という選択肢が加わりました。</p>

<ul>
<li><a href="https://developer.xamarin.com/guides/xamarin-forms/effects/">Customizing Controls with Effects &ndash; Xamarin</a></li>
<li><a href="http://ticktack.hatenablog.jp/entry/2016/01/26/020248">【Xamarin.Forms 2.1.0(プレビュー)】Effects &ndash; ぴーさんログ</a></li>
</ul>


<p>では、<code>CustomMasterDetailRenderer.cs</code> を Effects に変えてみましょう。</p>

<p>```csharp CustomMasterDetailEffect.cs
using System;
using MasterDetail.iOS;
using MonoTouch.UIKit;
using Xamarin.Forms;
using Xamarin.Forms.Platform.iOS;</p>

<p>[assembly: ResolutionGroupName(&ldquo;mycompany&rdquo;)]
[assembly: ExportEffect(typeof(CustomMasterDetailEffect), &ldquo;CustomMasterDetailEffect&rdquo;)]
namespace MasterDetail.iOS
{</p>

<pre><code>public class CustomMasterDetailEffect : PlatformEffect
{
    protected override void OnAttached()
    {
        var page = Element as MasterDetailPage;
        page.Appearing += Page_Appearing;
    }

    protected override void OnDetached()
    {
        var page = Element as MasterDetailPage;
        page.Appearing -= Page_Appearing;
    }

    void Page_Appearing(object sender, EventArgs e)
    {
        var vc = GetParentViewController();
        var page = Element as MasterDetailPage;

        var navigationItem = vc.NavigationController.TopViewController.NavigationItem;
        navigationItem.LeftBarButtonItems = new UIBarButtonItem[]
        {
            new UIBarButtonItem("MENU", UIBarButtonItemStyle.Plain, (_, __) =&gt; 
            { 
                page.IsPresented = !page.IsPresented; 
            })
        };
    }

    UIViewController GetParentViewController()
    {
        UIResponder responder = this.Container;
        while ((responder = responder.NextResponder) != null)
        {
            if (responder is UIViewController)
            {
                return (UIViewController)responder;
            }
        }
        return null;
    }
}
</code></pre>

<p>}
```</p>

<p>Effect は、 <code>ResolutionGroupName</code> と <code>ExportEffect</code> で定義した名称を使って、PCL側プロジェクトで Page に追加します。</p>

<p>```csharp RootPage.cs
public class RootPage : MasterDetailPage
{</p>

<pre><code>public RootPage ()
{
    NavigationPage.SetHasBackButton(this, false);
    // Effect を追加する
    Effects.Add(Effect.Resolve("mycompany.CustomMasterDetailEffect"));

    // 以下省略
</code></pre>

<p>```</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/customizing_left_navvigationbar_button_in_masterdetail_with_navigation_pages_05.png" alt="" /></p>

<p>こちらも、CustomRenderer と同じことができました。</p>

<p>が、ちょっと黒魔術っぽいの使ってます。</p>

<ul>
<li><code>Effects.Container</code> から取得できるのは <code>UIView</code> です。親の <code>UIViewController</code> を得るには、 <code>GetParentViewController()</code> でやってるような事をしなければなりません</li>
<li>CustomRenderer はそれ自体は <code>ViewController</code> だったので <code>ViewWillAppear()</code> など画面のライフサイクルコールバックを override することができました。が、Effects から ViewController のライフサイクルイベントをハンドリングできません。代わりに Xamarin.Forms 側の <code>Page</code> のライフサイクルから <code>Appearing</code> イベントで処理するようにしています。そのため、「MENU」ボタンが表示されるタイミングが若干遅れます。</li>
</ul>


<h2>CustomRenderer と Effects 、どちらを使えばいいの？</h2>

<ul>
<li>CustomRenderer はできる事は多いが、複数の CustomRenderer を適用することはできない</li>
<li>Effects はできる事は少ないが、複数の機能拡張を同時に適用できる</li>
</ul>


<p>以上を考えると、</p>

<ol>
<li>まずあなたの行いたいことが Effects で実現できないか、試してみる</li>
<li>Effects でできないレベルなら CustomRenderer を選択する</li>
</ol>


<p>となるでしょう。</p>

<p>本件のネタは、 Effects ではかなりムリをして実現しているので、CustomRenderer の方が相応しいと思われます。
が、CustomRenderer はここぞという時にとっておきたい気もします。
このさじ加減は、作るアプリの規模・深度、汎用性、再利用性などによって変わってくるでしょう。Effects の方が汎用性・再利用性は高いですが、ネイティブのUIパーツをごっそり入れ替えるような深い事は、CustomRenderer でなければできません。</p>

<p>今回のプログラムは Github に上げてあります。（<code>CustomMasterDetailRenderer.cs</code> はコメントアウトしてあって、Effects の方を活かしてます。）</p>

<ul>
<li><a href="https://github.com/amay077/XFNavigationWithMasterDetailSample/blob/master/README.md">XFNavigationWithMasterDetailSample/README.md at master · amay077/XFNavigationWithMasterDetailSample</a></li>
</ul>


<p>私は「Effects で頑張りたい派」かな。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[非同期処理の書き方を Java と Swift と Xamarin で比較する]]></title>
    <link href="http://blog.amay077.net/blog/2016/07/19/comparison_async_logic_with_java_swift_xamarin/"/>
    <updated>2016-07-19T23:59:59+09:00</updated>
    <id>http://blog.amay077.net/blog/2016/07/19/comparison_async_logic_with_java_swift_xamarin</id>
    <content type="html"><![CDATA[<p>「重たい処理を非同期で実行して、結果をメインスレッドで画面に表示」を、</p>

<!--more-->


<ul>
<li>Android-Java</li>
<li>iOS-Swift</li>
<li>Xamarin(Android も iOS も同じ)</li>
</ul>


<p>で比較。</p>

<hr />

<h2>Android</h2>

<p>```java
@Override
public void onClick(View view) {</p>

<pre><code>new AsyncTask&lt;Void, Void, Long&gt;() {
    @Override
    protected Long doInBackground(Void[] p) {
        // ワーカースレッド
        long ret = 0;
        for (long i = 0; i &lt; 1000000000; i++)
            ret += i;
        return ret;
    }

    @Override
    protected void onPostExecute(Long result) {
        // UIスレッド
        text1.setText(String.valueOf(result));
    }
}.execute((Void)null);
</code></pre>

<p>}
```</p>

<hr />

<h2>Swift</h2>

<p>```java
@IBAction func onTouchUpInside(sender: AnyObject) {</p>

<pre><code>weak var weakSelf = self
dispatch_async(dispatch_get_global_queue(
    DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), {
    // ワーカースレッド
    var ret:Int = 0
    for i in 0...1000000000 {
        ret += i
    }

    dispatch_async(dispatch_get_main_queue(), {
        // UIスレッド
        weakSelf?.label1.text = String(ret)
    });
});
</code></pre>

<p>}
```</p>

<hr />

<h2>Xamarin(Android も iOS も)</h2>

<p>```csharp
Task<long> FatProc() => Task.Run<long>(() => {</p>

<pre><code>long ret = 0;
for (long i = 0; i &lt; 1000000000; i++)
    ret += i;
return ret;
</code></pre>

<p>});</p>

<p>button1.TouchUpInside += async (_, e) => {</p>

<pre><code>var ret = await FatProc(); // ワーカースレッド
label1.Text = ret.ToString(); // UIスレッド
</code></pre>

<p>};
```</p>

<hr />

<h2>Xamarin はいいぞ！</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[カスタムマーカーに対応した Xamarin.Forms.GoogleMaps v1.4.0 をリリースしました]]></title>
    <link href="http://blog.amay077.net/blog/2016/07/18/xamarin_forms_googlemaps_v1_4_0_released/"/>
    <updated>2016-07-18T17:00:00+09:00</updated>
    <id>http://blog.amay077.net/blog/2016/07/18/xamarin_forms_googlemaps_v1_4_0_released</id>
    <content type="html"><![CDATA[<p>Xamarin.Forms.GoogleMaps v1.4.0 をリリースしました。</p>

<!--more-->


<ul>
<li><a href="https://www.nuget.org/packages/Xamarin.Forms.GoogleMaps/1.4.0">NuGet Gallery | Xamarin.Forms.GoogleMaps 1.4.0</a></li>
</ul>


<p>待望？のカスタムマーカーに対応しました。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/xamarin_forms_googlemaps_v1_4_0_released_001.png" alt="image001" /></p>

<h2>カスタムマーカーの使い方</h2>

<p><code>Pin.Icon</code> に <code>BitmapDescriptorFactory</code> により生成される <code>BitmapDescriptor</code> を設定します。</p>

<p><code>BitmapDescriptorFactory</code> の３つのファクトリメソッドにより、
「デフォルトマーカーの色を変える」「プラットフォーム毎の画像リソースを使用する」「共通の画像リソースを使用する」
の３つが使用できます。</p>

<h3>デフォルトマーカーの色を変える</h3>

<p><a href="https://developers.google.com/maps/documentation/ios-sdk/reference/interface_g_m_s_marker.html?hl=ja#ae320cb082a68c22eb1f37955f8e56228"><code>iOS:GMSMarker.markerImageWithColor</code></a>, <a href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/BitmapDescriptorFactory.html?hl=ja#defaultMarker(float"><code>Android:BitmapDescriptorFactory.defaultMarker</code></a>) に対応する、既定のマーカー形状の色のみを変える機能です。</p>

<p>以下のように、 <code>BitmapDescriptorFactory.DefaultMarker(Color)</code> メソッドを使用します。</p>

<p><code>csharp
pin.Icon = BitmapDescriptorFactory.DefaultMarker(Color.Pink);
</code></p>

<h3>プラットフォーム毎の画像リソースを使用する</h3>

<p><a href="https://developers.google.com/maps/documentation/ios-sdk/marker?hl=ja#_7"><code>iOS:UIImage.imageNamed</code></a>, <a href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/BitmapDescriptorFactory.html?hl=ja#defaultMarker(float"><code>Android:BitmapDescriptorFactory.fromAsset</code></a>) に対応する、プラットフォーム固有の画像リソースを、マーカー画像として使用する機能です。</p>

<p>以下のように、 <code>BitmapDescriptorFactory.FromBundle(string)</code> メソッドを使用します。</p>

<p><code>csharp
pin.Icon = BitmapDescriptorFactory.FromBundle("image01.png");
</code></p>

<p>引数の bundleName は、 <strong>同じ名称で</strong> 、プラットフォーム毎に次のように用意されている必要があります。</p>

<h4>Android の場合</h4>

<p>Android側のプロジェクトの <code>Assets</code> ディレクトリ内に <code>image01.png</code> を追加し、 Build Action を ”Android Asset” に設定します。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/xamarin_forms_googlemaps_v1_4_0_released_002.png" alt="image001" /></p>

<h4>iOS の場合</h4>

<p>iOS側のプロジェクト <code>image01.png</code> を追加し、 Build Action を ”BundleResource” に設定します。</p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/xamarin_forms_googlemaps_v1_4_0_released_003.png" alt="image001" /></p>

<h3>共通の画像リソースを使用する</h3>

<p>画像を <code>Stream</code> を直接指定できる、機能です。</p>

<p>以下のように、 <code>BitmapDescriptorFactory.DefaultMarker(Color)</code> メソッドを使用します。</p>

<p>```csharp
// PCLプロジェクトに EmbeddedResouece として追加した &ldquo;marker01.png&rdquo; を読み込んで Stream 化
var assembly = typeof(CustomPinsPage).GetTypeInfo().Assembly;
var stream = assembly.GetManifestResourceStream($&ldquo;XFGoogleMapSample.marker01.png&rdquo;);</p>

<p>// Stream をマーカーに設定
pin.Icon = BitmapDescriptorFactory.FromStream(stream);
```</p>

<h2>【注意】プラットフォーム毎のマーカーサイズの違い</h2>

<p>「プラットフォーム毎の画像リソースを使用する」「共通の画像リソースを使用する」で見られる現象なのですが、iOS と Android では <strong>同じサイズの画像を指定しているのに iOS の方が大きく描画されます</strong></p>

<p><img src="https://dl.dropboxusercontent.com/u/264530/qiita/xamarin_forms_googlemaps_v1_4_0_released_004.png" alt="image001" /></p>

<p>なぜこうなるのか分かりませんが、 <a href="https://developers.google.com/maps/documentation/ios-sdk/intro?hl=ja">Google Maps SDK for iOS</a> と <a href="https://developers.google.com/maps/documentation/android-api/intro?hl=ja">Google Maps Android API</a> を直接使用した時もこうなるので、両者の仕様というかプラットフォーム自体の仕様なのかも知れません。</p>

<p>特に <code>BitmapDescriptorFactory.FromStream</code> を使用した時には使い勝手が悪いのですが、「ネイティブの Google Maps SDK の機能を共通APIでラップする」のが第一目標なので、とりあえず画像を何も加工しない実装でリリースしました。</p>

<p>何か原因などについてヒントがある方は</p>

<ul>
<li><a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps/issues/40">Why custom pin icon in iOS bigger than Android? · Issue #40 · amay077/Xamarin.Forms.GoogleMaps</a></li>
</ul>


<p>に書いてもらえると助かります（日本語で大丈夫です）。</p>

<h2>サンプルプログラム</h2>

<p><a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps/tree/master/XFGoogleMapSample">XFGoogleMapSample</a> の <a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps/blob/master/XFGoogleMapSample/XFGoogleMapSample/CustomPinsPage.xaml.cs"><code>CustomPinsPage.xaml.cs</code></a> でこれらの機能を使用しています。</p>

<p>是非使ってみてください。よければ <a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps">Github リポジトリ</a> に Star ください。</p>
]]></content>
  </entry>
  
</feed>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: gps | Experiments Never Fail]]></title>
  <link href="http://blog.amay077.net/blog/categories/gps/atom.xml" rel="self"/>
  <link href="http://blog.amay077.net/"/>
  <updated>2016-07-08T00:46:15+09:00</updated>
  <id>http://blog.amay077.net/</id>
  <author>
    <name><![CDATA[amay077]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[TimeoutableLocationListener というのを作ってみた]]></title>
    <link href="http://blog.amay077.net/blog/2011/01/13/timeoutable-locationlistener/"/>
    <updated>2011-01-13T04:30:00+09:00</updated>
    <id>http://blog.amay077.net/blog/2011/01/13/timeoutable-locationlistener</id>
    <content type="html"><![CDATA[<p>Android で GPS の位置を受信する場合、LocationListener というインターフェースを渡して位置が受信できるのをジッと待つわけです。Android での GPS の使い方はググるといっぱいでてきますもんね。</p>

<!--more-->


<p>で、LocationManager.onStatusChanged というメソッドがあって、例えば屋内とかで、受信できずにあきらめた場合、こいつが呼び出されるのかと思いきや、期待したようなタイミングで受信してくれません。</p>

<p>結局自力でタイムアウト処理を書いて GPS を止めるハメになるのですが、いつも同じ処理を書くのが面倒なので、共通っぽいクラスにしてみました。</p>

<p><div><script src='https://gist.github.com/777790.js'></script>
<noscript><pre><code>&lt;html&gt;&lt;body&gt;You are being &lt;a href=&quot;https://github.com/gist/777790&quot;&gt;redirected&lt;/a&gt;.&lt;/body&gt;&lt;/html&gt;</code></pre></noscript></div>
</p>

<p>LocationListener の代わりにこの TimeoutableLocationListener をセットします。いつもと違うのは以下の2箇所です。</p>

<ul>
<li>コンストラクタで、LocationManager , タイムアウト時間（ミリ秒）, タイムアウト時に呼び出されるリスナ を渡す。</li>
<li>自分のクラスで onLocationChanged を Override した時に、必ず base.onLocationChanged を呼び出す。</li>
</ul>


<p>interface じゃなくなっちゃったので、ちょっと不自由ですが、まあ使えるのではないかと思います。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Google Latitude の履歴情報を晒してみる]]></title>
    <link href="http://blog.amay077.net/blog/2011/01/05/google-latitude/"/>
    <updated>2011-01-05T03:53:00+09:00</updated>
    <id>http://blog.amay077.net/blog/2011/01/05/google-latitude</id>
    <content type="html"><![CDATA[<p>昨年の暮れ、Google Latitude の iPhone 版が公開され、ツイッターなどでにぎわってましたが、自分は Android で 二年前から使ってたわー（嘘）、数ヶ月前から使ってました。</p>

<!--more-->


<p>その機能の中に 「履歴を保存する」 というのがあって、これまた興味本位で 「ON」 にしていたのですが、PC 版の <a href="https://www.google.com/latitude/">Google Latitude</a> サイトで見られたんですね、初めて気づきました。</p>

<p>で、その中には、自宅や職場の位置が教えてもいないのに表示されていて、これがまた当たってるもんだから Google こえーわー なんですが、どんな位置が保存されているかも見ることができます。</p>

<p>試しに自分の行動履歴を晒してみます。</p>

<p><img src="https://dl.dropbox.com/u/264530/qiita/latitude_1.png" alt="&quot;1&quot;" /></p>

<p>といっても 自宅（豊橋）と職場（名古屋）を往復するだけの日々ですねｗ
これなら Google さんにとっても自宅と職場の位置は容易に推測できるでしょう。
なんか、大阪 や 岡山 へ行ったことになってますが、記憶にないですｗ
恐らく例の WiFi による測位で位置がぶっ飛ぶ現象だと思います。
データの時刻を見てみると、驚くことに２４時間、定期的に位置情報が送信されていることが分かります。こわー。
深夜時間帯は１時間に１回、日中は短ければ１分間隔にもなりますね。たぶん移動具合によって感覚を伸ばしたり縮めたりしてるんでしょうね、Google さんの事ですから。
位置の取得方法は、 GPS＋WiFi＋携帯基地局 のハイブリッドなようです。
次の画像を見てください。</p>

<p><img src="https://dl.dropbox.com/u/264530/qiita/latitude_2.png" alt="&quot;2&quot;" /></p>

<p>履歴の点をクリックすると、Accuracy （精度） の円が表示されます。
この絵では半径５kmくらいなので恐らく携帯基地局からの推定位置ですが、他の点をクリックすると、円の大きさが小さいものも確認できます。
ただ、さすがに深夜に勝手に GPS を起動させてるとは思いにくいので、基本は WiFi＋基地局で、他のアプリで GPS を使ってる時だけ、コバンザメのように GPS の位置をもらって送信してるんだと思います。</p>

<p>あとあと、画面の右上に ▲ の再生ボタンがあって、行動履歴をトレースできます。致せり尽くせりですね。</p>

<p>さあ、こんな Google の怖くて便利な世界に、あなたも飛び込んでみませんか？
Android 版 Google Latitude では、メニュー の プライバシー から、「ロケーション履歴を有効にする」を ON にするだけです。
簡単ですね、あーこわいこわい♪</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WiFi 位置測位の精度を調べてみた（沿岸道路編）]]></title>
    <link href="http://blog.amay077.net/blog/2011/01/02/wifi-location-accuracy2/"/>
    <updated>2011-01-02T03:01:00+09:00</updated>
    <id>http://blog.amay077.net/blog/2011/01/02/wifi-location-accuracy2</id>
    <content type="html"><![CDATA[<p>えーと、今年もよろしくおねがいします。</p>

<!--more-->


<p>WiFi 位置測位の精度を調べてみた で、WiFi（というか NETWORK_PROVIDER）の位置測位が結構精度が高い事を紹介しましたが、いろんなケースでデータを取ってみないとなんとも言えないので、今日浜松に遊びに行った際に GPS_PROVIDER と NETWORK_PROVIDER でロギングしてみました。</p>

<h3>環境</h3>

<ul>
<li>使用端末： IS03</li>
<li>移動ルート： 愛知県豊橋市 → 静岡県浜松市</li>
<li>移動手段： 車（主に国道1号線、国道23号線）</li>
<li>移動時間： 約50分</li>
<li>GPS 有効、WiFi 有効</li>
</ul>


<h3>計測方法</h3>

<ul>
<li>5分に1回計測を行う。</li>
<li>GPS（GPS_PROVIDER） と WiFi（NETWORK_PROVIDER） を同時に計測開始する。</li>
<li>GPS を起動し、計測が完了したらすぐにGPSを終了する。5分後また起動…その繰り返し。</li>
</ul>


<h3>結果（青：GPS、赤：NETWORK）</h3>

<p><img src="https://dl.dropbox.com/u/264530/qiita/wifilocation_21.png" alt="&quot;1&quot;" /></p>

<p>ロギング間隔を前回の1分から5分にしたので、点と点の距離が結構開いてます。
前回の電車通勤時では、線路周辺に WiFi 基地局がたくさんあるため NETWORK_PROVIDER でもなかなかの精度が出ると予想しましたが、その推測は正しかったようで、今回の場合、家がほとんどない沿岸道路（浜名バイパス）を走行時の測位はかなり精度が落ちています。</p>

<p>おそらく WiFi での測位をあきらめ、3G基地局での測位に切り替わっていると思われます。
ちなみにこの時に Accuracy は、3900～4900m 、浜松市街では 60～80m でした。</p>

<p>また今回位置がぶっ飛ぶ現象は発生しませんでした。偶然かなあ。</p>

<p>印象としては NETWORK_PROVIDER でも Accuracy が 100m 以内のデータはそれなり精度で使えるんじゃないかなあ、という感じです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[基地局での位置測位の精度を調べてみた]]></title>
    <link href="http://blog.amay077.net/blog/2010/12/29/cell-location-accuracy/"/>
    <updated>2010-12-29T07:18:00+09:00</updated>
    <id>http://blog.amay077.net/blog/2010/12/29/cell-location-accuracy</id>
    <content type="html"><![CDATA[<p>前回、WiFi 位置測位の精度を調べてみた の続きで、GPS も WiFi も無効だった場合、つまり携帯電話の基地局による位置測位の精度を調べてみました。</p>

<!--more-->


<p>経路は前回と同じです。
計測方法も同じで、ただ GPS も WiFi も端末の設定で OFF にしています。
で結果です。（青が 前回と同じGPSデータ、黄色が基地局の測位結果です）</p>

<p><img src="https://dl.dropbox.com/u/264530/qiita/celllocation_map.png" alt="&quot;photo&quot;" /></p>

<p>どうです？こちらも結構使えそうでしょ？
Accuracy （精度）の値は、3000～5000ｍ 、だいたい目視でもその範囲内で収まってる感じです。
しかも WiFi のように突然位置がぶっ飛ぶ現象も起こってません。</p>

<p>さて、んじゃあ WiFi 捨ててこっち使えば？あるいは WiFi とこっちで精度の高いほう使えば？ってトコなんですが、「WiFi が有効な時に、あえて基地局だけを使って測位する方法」が分からんのです。(・・;)</p>

<p>Android の位置を取得するための Provider は GPS_PROVIDER と NETWORK_PROVIDER の二つしかなく、WiFi と基地局は NETWORK_PROVIDER に分類されると思うのですが、その中で基地局のみと指定する事ができるのかすら分かってません。</p>

<p>誰か知ってたら教えてください。m(<em> </em>)m</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WiFi 位置測位の精度を調べてみた]]></title>
    <link href="http://blog.amay077.net/blog/2010/12/28/wifi-location-accuracy/"/>
    <updated>2010-12-28T07:32:00+09:00</updated>
    <id>http://blog.amay077.net/blog/2010/12/28/wifi-location-accuracy</id>
    <content type="html"><![CDATA[<p>Android の位置測位には GPS を使うものと、WiFi（+基地局?）を使うものがあります。</p>

<!--more-->


<p>既に知れ渡っている通り、GPS は精度は高いですが、電池消費が激しいです。</p>

<p>一方 WiFi による位置測位は、データベース化された無線LANルータの位置と、Android 端末での電波強度などから位置を推定するもので、GPS ほど精度は高くないものの、GPS が使えない屋内などでも使用できる利点があります。（詳しくは 「wifi 位置情報 仕組み」 とかでググってください）</p>

<p>今回は、GPS ほどは電池を消費しない、WiFi による位置測位がどれ程の精度か、ためしに自分が会社から帰る道程で計測してみました。</p>

<h3>環境</h3>

<p>使用端末： IS03
移動ルート： JR金山駅 → 二川駅 （共に愛知県）
移動手段： JR東海道線・特別快速 （Max 時速100km/h くらい？）
移動時間： 約1時間</p>

<h3>計測方法</h3>

<p>1分に1回計測を行う。
GPS（GPS_PROVIDER） と WiFi（NETWORK_PROVIDER） を同時に計測開始する。
GPS を起動し、計測が完了したらすぐにGPSを終了する。1分後また起動…その繰り返し。</p>

<h3>計測結果</h3>

<p>まず GPS です。画面左上から右下へ向かうルートです。73点測位されました。（★は気にしないで下さい。私のお気に入りの場所です(^^）</p>

<p><img src="https://dl.dropbox.com/u/264530/qiita/wifilocation_1.png" alt="&quot;1&quot;" /></p>

<p>つぎに WiFi です。こちらは 65 点測位されました。Android の位置取得の仕組みは位置情報が変化しないとイベントが発生しないため、GPS よりもやや少なくなっています。それでも予想外の多さでした。</p>

<p><img src="https://dl.dropbox.com/u/264530/qiita/wifilocation_2.png" alt="&quot;2&quot;" />
<img src="https://dl.dropbox.com/u/264530/qiita/wifilocation_3.png" alt="&quot;3&quot;" /></p>

<p>途中、ヒゲのようなものが出ています。大きな誤差のように見えますが、異常なのは1点だけです。
それを削除したのが 2枚目の画像で、キレイな線になっています。
このようなヒゲができる原因としては、WiFi では無線ルータの ID に対して位置を付与するため、その無線ルータが引越しなどで移動すると、付与した位置とズレてしまうことになります。 推測ですが、このような「移動した無線ルータ」から位置を取得してしまったのではないかと考えます。</p>

<h3>2010.12.29 追記</h3>

<p>このヒゲ、Accuracy で判断できないのか？と <a href="http://twitter.com/#!/RKisato/status/19792645240918016">@RKisato さんからご指摘</a>いただきましたが、この点の Accuracy は 5000m 、しかし実際はもっとズレています。他にも Accuracy が 5000 に近い点は複数ありましたが、ここほどずれていませんでした。なので、Accuracy も判定基準に成り得ないと思っています。</p>

<p>GPS と WiFi（ゴミ削除後）を重ねてみました。</p>

<p><img src="https://dl.dropbox.com/u/264530/qiita/wifilocation_4.png" alt="&quot;4&quot;" /></p>

<p>意外な程、ぴったりと重なっています。もっと拡大すると1～2km ズレているところもありますが、俯瞰した地図では、 WiFi 測位は GPS と比べてもまったく問題とならない精度であることが分かりました。</p>

<h3>懸案</h3>

<ul>
<li>今回は電車に乗っての測位でした。線路の周りには家屋がたくさんあり、そこでは家庭用の無線ルータが数多く使われています。つまり今回のケースは WiFi 測位に有利な環境だったと想像できます。これが山岳地帯など家屋（無線ルータ）の少ない地域だともっと精度が落ちていたと思われます。</li>
<li>同時に GPS でも測位していた事により精度が向上した？ Android では、GPS を有効する時に、そのデータを（個人が特定できない程度に）Google に送信する事に同意するよう求められます。これも推測ですが、GPS と WiFi がどちらも有効な場合、GPS の測位結果を、最寄りの無線ルータの緯度経度として登録するような仕組みが動いているのではないかと思います。これにより、実は WiFi 測位の精度を改善しながら計測していた可能性があります。</li>
<li>WiFi も無効だったらどうする？ GPS 程ではないにせよ、WiFi も電池は消費するので、電池の持ちにウルサイ人は、好んで WiFi を OFF にしています。その時に NETWORK_PROVIDER を使って位置を測位するとどうなるのか？恐らく携帯電話の基地局から位置が側位されるはずです。その際の精度も検証の必要があります。</li>
</ul>


<h4>2010.12.29 追記</h4>

<p>検証しました → 基地局での位置測位の精度を調べてみた</p>

<h4>2010.12.29 追記</h4>

<p>ここで示した地図上の軌跡は「時間軸」が考慮されていません。一見、「同じ時刻で同じ位置」であるように見えますが、同じ位置で見たときに時刻がズレているかも知れません。（というより必ずズレはあって、それが許容範囲内かどうかがポイントですが）</p>

<h3>まとめ</h3>

<ul>
<li>WiFi による位置測位は、予想よりも高い精度であることが分かった。</li>
<li>しかし、場所を変えて検証する必要がある。</li>
<li>ヒゲの対策を盛り込めば、十分に実用できるレベルである。</li>
<li>Android が普及すればする程、Google は情報を手にし、WiFi 測位の精度も上がっていきます。いずれ GPS を凌駕する日が来るかも？です。</li>
</ul>

]]></content>
  </entry>
  
</feed>
